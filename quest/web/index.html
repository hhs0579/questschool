<!DOCTYPE html>
<html>
  <head>
    <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
    <base href="$FLUTTER_BASE_HREF" />

    <meta charset="UTF-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta
      name="description"
      content="퀘스트스쿨은 진로 콘텐츠 전문 기업 사자가온다(주)에서 개발한 교내 진로진학 상담 솔루션 서비스입니다."
    />

    <!-- iOS meta tags & icons -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="퀘스트스쿨" />
    <link rel="apple-touch-icon" href="icons/favicon.png" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png" />

    <title>퀘스트스쿨</title>
    <link rel="manifest" href="manifest.json" />

    <script>
      // The value below is injected by flutter build, do not touch.
      const serviceWorkerVersion = null;
    </script>
    <!-- 다음 주소 API 먼저 로드 -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!-- EmailJS SDK 추가 -->
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"
    ></script>
    <script type="text/javascript">
      (function () {
        emailjs.init("dv2MXIIsVGZIIzcSk");
      })();

      window.sendEmailJS = function (
        serviceId,
        templateId,
        templateParams,
        publicKey
      ) {
        return emailjs
          .send(serviceId, templateId, templateParams, publicKey)
          .then(function (response) {
            console.log("SUCCESS!", response.status, response.text);
            return {
              success: true,
              message: "이메일이 성공적으로 전송되었습니다.",
            };
          })
          .catch(function (error) {
            console.log("FAILED...", error);
            return {
              success: false,
              message: "이메일 전송에 실패했습니다: " + error,
            };
          });
      };
    </script>
    <!-- This script adds the flutter initialization JS code -->
    <script src="flutter.js" defer></script>
    <script>
      function initDaumPostcode(callback) {
        new daum.Postcode({
          oncomplete: function (data) {
            var address = data.address;
            if (data.buildingName !== "") {
              address += " (" + data.buildingName + ")";
            }
            callback(address);
          },
        }).embed();
      }
    </script>
    <script>
      function searchAddress() {
        new daum.Postcode({
          oncomplete: function (data) {
            var address = data.address;
            if (data.buildingName !== "") {
              address += " (" + data.buildingName + ")";
            }

            // Flutter로 데이터 전송
            window.parent.postMessage(
              JSON.stringify({
                type: "address",
                address: address,
              }),
              "*"
            );
          },
        }).open();
      }
    </script>
  </head>
  <body>
    <!-- 로딩 화면 (선택사항) -->
    <div
      id="loading"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #f5f5f5;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: Arial, sans-serif;
        z-index: 9999;
      "
    >
      <div style="text-align: center">
        <div
          style="
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top: 4px solid #ff7700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
          "
        ></div>
      </div>
    </div>

    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <!-- 단일 Flutter 초기화 스크립트 -->
    <script
      type="application/javascript"
      src="assets/packages/flutter_inappwebview_web/assets/web/web_support.js"
      defer
    ></script>
    <script>
      window.addEventListener("load", function (ev) {
        // 로딩 화면 숨기기 함수
        function hideLoading() {
          const loading = document.getElementById("loading");
          if (loading) {
            loading.style.display = "none";
          }
        }

        // Flutter 앱 초기화
        _flutter.loader.loadEntrypoint({
          serviceWorker: {
            serviceWorkerVersion: serviceWorkerVersion,
          },
          onEntrypointLoaded: function (engineInitializer) {
            engineInitializer
              .initializeEngine({
                renderer: "html", // HTML 렌더러 사용 (안정적)
              })
              .then(function (appRunner) {
                // 로딩 화면 숨기기
                hideLoading();
                // Flutter 앱 실행
                appRunner.runApp();
              })
              .catch(function (error) {
                console.error("Flutter 엔진 초기화 실패:", error);
                hideLoading();
                // 에러 메시지 표시
                document.body.innerHTML =
                  '<div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;"><h2>앱 로딩 중 문제가 발생했습니다</h2><p>페이지를 새로고침해주세요.</p></div>';
              });
          },
        });
      });
    </script>
  </body>
</html>
